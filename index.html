<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="–û–±–ª—ñ–∫ –≤–∏—Ç—Ä–∞—Ç">
  <!-- –û–°–¨ –ì–û–õ–û–í–ù–ï –î–õ–Ø iPhone -->
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">

  <!-- Web App Manifest -->
  <link rel="manifest" href="./site.webmanifest">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="96x96" href="./favicon-96x96.png">
  <link rel="icon" type="image/jpeg" href="./favicon.jpeg">

  <title>–û–±–ª—ñ–∫ –≤–∏—Ç—Ä–∞—Ç</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; padding: 20px; display: flex; align-items: center; justify-content: center;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px; padding: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      width: 100%; max-width: 400px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    h1 { text-align: center; color: #333; margin-bottom: 30px; font-size: 24px; font-weight: 600; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; font-size: 14px; }
    input, select, textarea {
      width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 12px;
      font-size: 16px; transition: all 0.3s ease; background: white; outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); transform: translateY(-2px);
    }
    select {
      cursor: pointer; appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 15px center; background-size: 16px; padding-right: 45px;
    }
    textarea { resize: vertical; min-height: 80px; font-family: inherit; }
    .amount-input { position: relative; }
    .amount-input::after {
      content: "‚Ç¥"; position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
      color: #888; font-size: 16px; pointer-events: none;
    }
    .amount-input input { padding-right: 35px; }
    .date-display { background: #f8f9fa; color: #666; font-style: italic; cursor: not-allowed; }
    .submit-btn {
      width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
      border: none; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px;
    }
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); }
    .submit-btn:active { transform: translateY(0); }
    .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .status-message { margin-top: 15px; padding: 12px; border-radius: 8px; text-align: center; font-weight: 500; display: none; }
    .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #ffffff; border-radius: 50%;
      border-top-color: transparent; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 480px) { .container { padding: 20px; margin: 10px; } h1 { font-size: 20px; } }
    .setup-info { background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 14px; color: #0066cc; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí∞ –û–±–ª—ñ–∫ –≤–∏—Ç—Ä–∞—Ç</h1>

    <form id="expenseForm">
      <div class="form-group">
        <label for="amount">–°—É–º–∞ (‚Ç¥)</label>
        <div class="amount-input">
          <input type="number" id="amount" name="amount" required min="0" step="0.01" placeholder="0.00" inputmode="decimal">
        </div>
      </div>

      <div class="form-group">
        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
        <select id="category" name="category" required>
          <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
          <option value="–ö–≤–∞—Ä—Ç–∏—Ä–∞">üè† –ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
          <option value="–ê–≤—Ç–æ–º–æ–±—ñ–ª—å">üöó –ê–≤—Ç–æ–º–æ–±—ñ–ª—å</option>
          <option value="–ü—Ä–æ–¥—É–∫—Ç–∏" selected>üõí –ü—Ä–æ–¥—É–∫—Ç–∏</option>
          <option value="–ó–¥–æ—Ä–æ–≤'—è">üíä –ó–¥–æ—Ä–æ–≤'—è</option>
          <option value="–í—Å–µ —ñ–Ω—à–µ">üì¶ –í—Å–µ —ñ–Ω—à–µ</option>
        </select>
      </div>

      <div class="form-group">
        <label for="date">–î–∞—Ç–∞</label>
        <input type="date" id="date" name="date" class="date-display" readonly>
      </div>

      <div class="form-group">
        <label for="comment">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
        <textarea id="comment" name="comment" placeholder="–û–ø–∏—Å –≤–∏—Ç—Ä–∞—Ç–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)"></textarea>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">–î–æ–¥–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É</button>
      <div id="statusMessage" class="status-message"></div>
    </form>
  </div>

  <script>
    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker (–æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª sw.js —É –∫–æ—Ä–µ–Ω—ñ —Ä–µ–ø–æ)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('./sw.js').then(
          () => console.log('ServiceWorker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ'),
          () => console.log('ServiceWorker –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏')
        );
      });
    }

    // PWA install –ø—Ä–æ–º–ø—Ç
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });
    function showInstallButton() {
      const installBtn = document.createElement('button');
      installBtn.textContent = 'üì± –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫';
      installBtn.className = 'submit-btn';
      installBtn.style.marginTop = '10px';
      installBtn.style.background = '#28a745';
      installBtn.onclick = installApp;
      document.querySelector('.container').appendChild(installBtn);
    }
    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.finally(() => { deferredPrompt = null; });
      }
    }

    // URL Google Apps Script (–≤–∫–∞–∑–∞–Ω–∏–π —Ç–æ–±–æ—é)
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxvY5sIu8qzcGhmD0ENkOHuSrVurub4xd_a8AXQ4mbsKIKG3R4ypo3rKSQUcOk2uRhilg/exec';

    // –°—å–æ–≥–æ–¥–Ω—ñ—à–Ω—è –¥–∞—Ç–∞
    document.addEventListener('DOMContentLoaded', function () {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('date').value = today;
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏ —á–µ—Ä–µ–∑ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π iframe (—Å—É–º—ñ—Å–Ω–æ –∑ GAS)
    document.getElementById('expenseForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      const statusMessage = document.getElementById('statusMessage');

      const formData = new FormData(this);
      const data = {
        amount: parseFloat(formData.get('amount')),
        category: formData.get('category'),
        date: formData.get('date'),
        comment: formData.get('comment') || '',
        timestamp: new Date().toISOString()
      };

      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading"></span>–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è...';
      statusMessage.style.display = 'none';

      try {
        if (!GOOGLE_SCRIPT_URL) throw new Error('–ù–µ–æ–±—Ö—ñ–¥–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Google Apps Script URL');

        const iframe = document.createElement('iframe');
        iframe.style.display = 'none'; iframe.name = 'hidden_iframe';
        document.body.appendChild(iframe);

        const form = document.createElement('form');
        form.method = 'POST'; form.action = GOOGLE_SCRIPT_URL; form.target = 'hidden_iframe';

        Object.keys(data).forEach(key => {
          const input = document.createElement('input');
          input.type = 'hidden'; input.name = key; input.value = data[key];
          form.appendChild(input);
        });

        document.body.appendChild(form);
        form.submit();

        setTimeout(() => {
          document.body.removeChild(form);
          document.body.removeChild(iframe);
        }, 1000);

        statusMessage.className = 'status-message status-success';
        statusMessage.textContent = '‚úÖ –í–∏—Ç—Ä–∞—Ç—É —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!';
        statusMessage.style.display = 'block';

        document.getElementById('amount').value = '';
        document.getElementById('category').value = '–ü—Ä–æ–¥—É–∫—Ç–∏';
        document.getElementById('comment').value = '';
        setTimeout(() => { document.getElementById('amount').focus(); }, 100);

      } catch (error) {
        console.error('Error:', error);
        statusMessage.className = 'status-message status-error';
        statusMessage.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        statusMessage.style.display = 'block';
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '–î–æ–¥–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É';
        setTimeout(() => { statusMessage.style.display = 'none'; }, 5000);
      }
    });

    // UX: –∞–≤—Ç–æ—Ñ–æ–∫—É—Å —Ç–∞ Enter ‚Üí –Ω–∞—Å—Ç—É–ø–Ω–µ –ø–æ–ª–µ
    window.addEventListener('load', function () { document.getElementById('amount').focus(); });
    document.getElementById('amount').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') { e.preventDefault(); document.getElementById('category').focus(); }
    });
  </script>
</body>
</html>
